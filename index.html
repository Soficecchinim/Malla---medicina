<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Medicina - Univ. Austral</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }
    .year {
      background-color: #e3ecf3;
      padding: 10px;
      border-radius: 10px;
    }
    .year h2 {
      text-align: center;
      color: #1c3b57;
    }
    .subject {
      background-color: #ffffff;
      border: 2px solid #b0cbe8;
      border-radius: 8px;
      padding: 5px;
      margin: 5px 0;
      cursor: pointer;
      position: relative;
      transition: background-color 0.3s;
    }
    .subject.approved {
      background-color: #a5d6a7;
    }
    .subject.locked {
      background-color: #e0e0e0;
      cursor: not-allowed;
    }
    .subject:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      white-space: pre-line;
      font-size: 12px;
      z-index: 999;
    }
    .progress {
      text-align: center;
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>游 Medicina - Universidad Austral</h1>
  <div class="grid" id="malla"></div>
  <div class="progress" id="progreso"></div>
  <div class="progress" id="porcentaje"></div>

  <script>
    const materias = [
      {id:1,nombre:'Anatom칤a 1',a침o:1,reqs:[]},
      {id:2,nombre:'Citolog칤a e Histolog칤a General',a침o:1,reqs:[]},
      {id:3,nombre:'Bioqu칤mica 1',a침o:1,reqs:[]},
      {id:4,nombre:'Anatom칤a 2',a침o:1,reqs:[]},
      {id:5,nombre:'Histolog칤a Especial',a침o:1,reqs:[2]},
      {id:6,nombre:'Bioqu칤mica 2',a침o:1,reqs:[3]},
      {id:7,nombre:'Antropolog칤a',a침o:1,reqs:[]},
      {id:8,nombre:'Teolog칤a 1',a침o:1,reqs:[]},
      {id:9,nombre:'Relaci칩n M칠dico Paciente 1',a침o:1,reqs:[]},

      {id:10,nombre:'Fisiolog칤a 1',a침o:2,reqs:[1,2,3,4,5,6]},
      {id:11,nombre:'Inmunolog칤a',a침o:2,reqs:[6]},
      {id:12,nombre:'Medicina Celular y Molecular',a침o:2,reqs:[2,3,5,6]},
      {id:13,nombre:'Microbiolog칤a',a침o:2,reqs:[]},
      {id:14,nombre:'칄tica',a침o:2,reqs:[7,8]},
      {id:15,nombre:'Bioestad칤stica',a침o:2,reqs:[]},
      {id:16,nombre:'Fisiolog칤a 2',a침o:2,reqs:[10]},
      {id:17,nombre:'Psicolog칤a',a침o:2,reqs:[]},
      {id:18,nombre:'Relaci칩n M칠dico Paciente 2',a침o:2,reqs:[9]},

      {id:19,nombre:'Fisiopatolog칤a',a침o:3,reqs:[11,16]},
      {id:20,nombre:'Farmacolog칤a 1',a침o:3,reqs:[11,16]},
      {id:21,nombre:'Epidemiolog칤a',a침o:3,reqs:[]},
      {id:22,nombre:'Teolog칤a 2',a침o:3,reqs:[14]},
      {id:23,nombre:'Anatom칤a Patol칩gica',a침o:3,reqs:[11,16]},
      {id:24,nombre:'Gen칠tica',a침o:3,reqs:[12]},

      {id:25,nombre:'Diagn칩stico por Im치genes',a침o:4,reqs:[]},
      {id:26,nombre:'Medicina Interna 1',a침o:4,reqs:[]},
      {id:27,nombre:'Cirug칤a',a침o:4,reqs:[26]},
      {id:28,nombre:'Otorrinolaringolog칤a',a침o:4,reqs:[]},
      {id:29,nombre:'Metodolog칤a de la Investigaci칩n',a침o:4,reqs:[]},
      {id:30,nombre:'Cuestiones de Bio칠tica',a침o:4,reqs:[22]},
      {id:31,nombre:'Medicina Interna 2',a침o:4,reqs:[26]},
      {id:32,nombre:'Toxicolog칤a',a침o:4,reqs:[]},
      {id:33,nombre:'Urolog칤a',a침o:4,reqs:[26]},
      {id:34,nombre:'Farmacolog칤a 2',a침o:4,reqs:[20]},
      {id:35,nombre:'Nutrici칩n',a침o:4,reqs:[]},

      {id:36,nombre:'Medicina Interna 3',a침o:5,reqs:[31]},
      {id:37,nombre:'Pediatr칤a',a침o:5,reqs:[]},
      {id:38,nombre:'Ginecolog칤a',a침o:5,reqs:[]},
      {id:39,nombre:'Enfermedades Infecciosas',a침o:5,reqs:[]},
      {id:40,nombre:'Traumatolog칤a',a침o:5,reqs:[]},
      {id:41,nombre:'Obstetricia',a침o:5,reqs:[]},
      {id:42,nombre:'Medicina Legal y Deontolog칤a M칠dica',a침o:5,reqs:[]},
      {id:43,nombre:'Psiquiatr칤a',a침o:5,reqs:[]},
      {id:44,nombre:'Neurolog칤a',a침o:5,reqs:[]},
      {id:45,nombre:'Atenci칩n Primaria de la Salud',a침o:5,reqs:[]},
      {id:46,nombre:'Oftalmolog칤a',a침o:5,reqs:[]},
      {id:47,nombre:'Dermatolog칤a',a침o:5,reqs:[]},
      {id:48,nombre:'Gesti칩n y Econom칤a de la Salud',a침o:5,reqs:[]},
      {id:49,nombre:'Salud P칰blica',a침o:5,reqs:[]},
      {id:50,nombre:'Medicina Cr칤tica',a침o:5,reqs:[]},

      {id:51,nombre:'Internado Rotatorio',a침o:6,reqs:[]},
      {id:52,nombre:'Seminarios de Bio칠tica',a침o:6,reqs:[]},
    ];

    const extraRestricciones = (id, aprobadas) => {
      const a침o = materias.find(m => m.id === id)?.a침o;
      if (a침o === 2) return materias.filter(m => m.a침o === 1 && aprobadas.includes(m.id)).length >= 3;
      if (a침o === 3) return materias.filter(m => m.a침o === 1).every(m => aprobadas.includes(m.id)) && aprobadas.includes(10);
      if (a침o === 4) return materias.filter(m => m.a침o === 2 || m.a침o === 3).every(m => aprobadas.includes(m.id));
      if (a침o === 5) return aprobadas.includes(26);
      if (id === 51) return materias.filter(m => m.a침o === 4 || m.a침o === 5).every(m => aprobadas.includes(m.id));
      return true;
    };

    const estado = JSON.parse(localStorage.getItem('estadoMedicina') || '{}');

    function render() {
      const grid = document.getElementById('malla');
      grid.innerHTML = '';
      const cols = Array.from({length: 6}, (_, i) => {
        const col = document.createElement('div');
        col.className = 'year';
        col.innerHTML = `<h2>${i+1}춿 a침o</h2>`;
        grid.appendChild(col);
        return col;
      });

      materias.forEach(m => {
        const el = document.createElement('div');
        const aprobadas = Object.entries(estado).filter(([_, v]) => v).map(([k]) => +k);
        const falta = m.reqs.filter(id => !estado[id]);
        const cumpleExtra = extraRestricciones(m.id, aprobadas);
        const bloqueada = falta.length > 0 || !cumpleExtra;
        el.className = 'subject';
        if (estado[m.id]) el.classList.add('approved');
        else if (bloqueada) el.classList.add('locked');
        el.textContent = m.nombre;
        if (bloqueada && !estado[m.id]) {
          let texto = '';
          if (falta.length > 0) texto += 'Faltan: ' + falta.map(f => materias.find(mm => mm.id === f).nombre).join(', ');
          if (!cumpleExtra) texto += (texto ? '\n' : '') + 'No cumple requisitos generales';
          el.setAttribute('data-tooltip', texto);
        }
        el.onclick = () => {
          if (bloqueada) return;
          estado[m.id] = !estado[m.id];
          localStorage.setItem('estadoMedicina', JSON.stringify(estado));
          render();
        };
        cols[m.a침o-1].appendChild(el);
      });

      const total = materias.length;
      const aprobadas = Object.values(estado).filter(x => x).length;
      const porcentaje = Math.round(aprobadas / total * 100);
      document.getElementById('progreso').textContent = `Progreso: ${aprobadas}/${total}`;
      document.getElementById('porcentaje').textContent = `Porcentaje completado: ${porcentaje}%`;
    }

    render();
  </script>
</body>
</html>
