<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Malla Curricular - Medicina Austral</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f7fa;
      color: #333;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
    }

    .container {
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      gap: 20px;
      margin-top: 20px;
    }

    .year-column {
      background-color: #ecf0f1;
      border-radius: 10px;
      padding: 10px;
      min-width: 250px;
      flex-shrink: 0;
    }

    .year-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .subject {
      background-color: #ffffff;
      border: 2px solid #bdc3c7;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 8px;
      cursor: pointer;
      position: relative;
      transition: background-color 0.2s, border-color 0.2s;
    }

    .subject.approved {
      background-color: #2ecc71;
      color: white;
      border-color: #27ae60;
    }

    .subject.locked {
      background-color: #dfe6e9;
      color: #999;
      cursor: not-allowed;
      border-color: #ccc;
    }

    .subject:hover:not(.locked) {
      background-color: #d0eaf8;
    }

    .tooltip {
      visibility: hidden;
      background-color: #2c3e50;
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 110%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      width: 200px;
      font-size: 0.85em;
    }

    .subject.locked:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }

    .progress {
      margin-top: 20px;
      text-align: center;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Medicina (Universidad Austral)</h1>
  <div class="container" id="curriculum"></div>
  <div class="progress" id="progress"></div>

  <script>
    const subjects = [
      { id: 1, name: "Anatomía 1", year: 1 },
      { id: 2, name: "Citología e Histología General", year: 1 },
      { id: 3, name: "Bioquímica 1", year: 1 },
      { id: 4, name: "Anatomía 2", year: 1 },
      { id: 5, name: "Histología Especial", year: 1, reqs: [2] },
      { id: 6, name: "Bioquímica 2", year: 1, reqs: [3] },
      { id: 7, name: "Antropología", year: 1 },
      { id: 8, name: "Teología 1", year: 1 },
      { id: 9, name: "Relación Médico Paciente 1", year: 1 },

      { id: 10, name: "Fisiología 1", year: 2, reqs: [1,2,3,4,5,6], global: [3] },
      { id: 11, name: "Inmunología", year: 2, reqs: [6], global: [3] },
      { id: 12, name: "Medicina Celular y Molecular", year: 2, reqs: [2,3,5,6], global: [3] },
      { id: 13, name: "Microbiología", year: 2, global: [3] },
      { id: 14, name: "Ética", year: 2, reqs: [7,8], global: [3] },
      { id: 15, name: "Bioestadística", year: 2, global: [3] },
      { id: 16, name: "Fisiología 2", year: 2, reqs: [10], global: [3] },
      { id: 17, name: "Psicología", year: 2, global: [3] },
      { id: 18, name: "Relación Médico Paciente 2", year: 2, reqs: [9], global: [3] },

      { id: 19, name: "Fisiopatología", year: 3, reqs: [11,16], globalAll: [1,2,3,4,5,6,7,8,9] },
      { id: 20, name: "Farmacología 1", year: 3, reqs: [11,16], globalAll: [1,2,3,4,5,6,7,8,9] },
      { id: 21, name: "Epidemiología", year: 3, globalAll: [1,2,3,4,5,6,7,8,9] },
      { id: 22, name: "Teología 2", year: 3, reqs: [14], globalAll: [1,2,3,4,5,6,7,8,9] },
      { id: 23, name: "Anatomía Patológica", year: 3, reqs: [11,16], globalAll: [1,2,3,4,5,6,7,8,9] },
      { id: 24, name: "Genética", year: 3, reqs: [12], globalAll: [1,2,3,4,5,6,7,8,9] },

      { id: 25, name: "Diagnóstico por Imágenes", year: 4, globalAllYears: [2,3] },
      { id: 26, name: "Medicina Interna 1", year: 4, globalAllYears: [2,3] },
      { id: 27, name: "Cirugía", year: 4, reqs: [26], globalAllYears: [2,3] },
      { id: 28, name: "Otorrinolaringología", year: 4, globalAllYears: [2,3] },
      { id: 29, name: "Metodología de la Investigación", year: 4, globalAllYears: [2,3] },
      { id: 30, name: "Cuestiones de Bioética", year: 4, reqs: [22], globalAllYears: [2,3] },
      { id: 31, name: "Medicina Interna 2", year: 4, reqs: [26], globalAllYears: [2,3] },
      { id: 32, name: "Toxicología", year: 4, globalAllYears: [2,3] },
      { id: 33, name: "Urología", year: 4, reqs: [26], globalAllYears: [2,3] },
      { id: 34, name: "Farmacología 2", year: 4, reqs: [20], globalAllYears: [2,3] },
      { id: 35, name: "Nutrición", year: 4, globalAllYears: [2,3] },

      { id: 36, name: "Medicina Interna 3", year: 5, reqs: [31] },
      { id: 37, name: "Pediatría", year: 5 },
      { id: 38, name: "Ginecología", year: 5 },
      { id: 39, name: "Enfermedades Infecciosas", year: 5 },
      { id: 40, name: "Traumatología", year: 5 },
      { id: 41, name: "Obstetricia", year: 5 },
      { id: 42, name: "Medicina Legal y Deontología Médica", year: 5 },
      { id: 43, name: "Psiquiatría", year: 5 },
      { id: 44, name: "Neurología", year: 5 },
      { id: 45, name: "Atención Primaria de la Salud", year: 5 },
      { id: 46, name: "Oftalmología", year: 5 },
      { id: 47, name: "Dermatología", year: 5 },
      { id: 48, name: "Gestión y Economía de la Salud", year: 5 },
      { id: 49, name: "Salud Pública", year: 5 },
      { id: 50, name: "Medicina Crítica", year: 5 },

      { id: 51, name: "Internado Rotatorio", year: 6, globalAllYears: [4,5] },
      { id: 52, name: "Seminarios de Bioética", year: 6 },
    ];

    const totalSubjects = subjects.length;

    function getApproved() {
      return JSON.parse(localStorage.getItem('approvedSubjects') || '[]');
    }

    function saveApproved(list) {
      localStorage.setItem('approvedSubjects', JSON.stringify(list));
    }

    function render() {
      const container = document.getElementById('curriculum');
      const progress = document.getElementById('progress');
      container.innerHTML = '';
      const approved = getApproved();

      for (let year = 1; year <= 6; year++) {
        const col = document.createElement('div');
        col.className = 'year-column';
        const title = document.createElement('div');
        title.className = 'year-title';
        title.textContent = `Año ${year}`;
        col.appendChild(title);

        subjects.filter(s => s.year === year).forEach(subj => {
          const div = document.createElement('div');
          div.className = 'subject';
          div.textContent = subj.name;

          const lockedReasons = [];

          if (subj.reqs && !subj.reqs.every(id => approved.includes(id))) {
            lockedReasons.push('Requiere: ' + subj.reqs.filter(id => !approved.includes(id)).join(', '));
          }

          if (subj.global && approved.filter(id => subjects.find(s => s.year === 1 && id === s.id)).length < subj.global[0]) {
            lockedReasons.push(`Requiere al menos ${subj.global[0]} materias de 1º año`);
          }

          if (subj.globalAll && !subj.globalAll.every(id => approved.includes(id))) {
            lockedReasons.push('Requiere todas las materias de 1º año');
          }

          if (subj.globalAllYears && subj.globalAllYears.some(y =>
            subjects.filter(s => s.year === y).some(s => !approved.includes(s.id)))) {
            lockedReasons.push(`Requiere todas las materias de ${subj.globalAllYears.map(y => y + 'º año').join(' y ')}`);
          }

          const isApproved = approved.includes(subj.id);
          const isLocked = lockedReasons.length > 0 && !isApproved;

          if (isApproved) div.classList.add('approved');
          if (isLocked) div.classList.add('locked');

          if (isLocked) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = lockedReasons.join('; ');
            div.appendChild(tooltip);
          }

          div.addEventListener('click', () => {
            if (isLocked) return;
            const newList = getApproved();
            if (isApproved) {
              const i = newList.indexOf(subj.id);
              if (i > -1) newList.splice(i, 1);
            } else {
              newList.push(subj.id);
            }
            saveApproved(newList);
            render();
          });

          col.appendChild(div);
        });

        container.appendChild(col);
      }

      const count = approved.length;
      const percent = ((count / totalSubjects) * 100).toFixed(1);
      progress.textContent = `Progreso: ${count} / ${totalSubjects} materias aprobadas (${percent}%)`;
    }

    render();
  </script>
</body>
</html>
